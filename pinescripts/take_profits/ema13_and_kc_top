if (allPassed)
    strategy.entry("Long", strategy.long, qty = lots)

// если ЕМА13 продолжает расти, то нужно выше
// но лучше не ждать, когда она начнет снижаться, а поймать закрыте выше KC top
// если нет выскочит за KC top, то хотя бы закрытие выше половины расстояния от середины до вершины

if (close > upperKC)
    strategy.exit("Long", stop = fixedSL, limit = close)
else if (dailyEMA13 > dailyEMA13[1] and close > middleKC + (upperKC - middleKC) / 100 * 80)
    strategy.exit("Long", stop = fixedSL, limit = close)

<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Подсчет калорий</title>
    <script>
        var weight = 88;
        var tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        var tomorrowDay = tomorrow.getDay();

        class Food {
            id = -1;
            name = '';
            belki = 0;
            giri = 0;
            uglevodi = 0;

            constructor(id, name, belki, giri, uglevodi) {
                this.id = id;
                this.name = name;
                this.belki = belki;
                this.giri = giri;
                this.uglevodi = uglevodi;
            }
        }

        let foodBasket = [
            new Food(1, 'чечевица', 8, 0, 20),
            new Food(2, 'индюшиная грудка', 23.7, 1.5, 0.1),
            new Food(3, 'макароны безглютеновые', 6.4, 2.5, 38),
            new Food(4, 'творог Bio Körniger Frischkäse', 12.7, 4, 1),
            new Food(5, 'пшенка', 3, 0.7, 17),
            new Food(6, 'гречка', 4, 1, 21),
            new Food(7, 'изолят', 87, 0.5, 2),
            new Food(8, 'овощи Iglo Pilz Pfanne', 1.8, 1.1, 7.2),
            new Food(9, 'овощи Edeka Land Gemüse', 2, 0.1, 5.9),
            new Food(10, 'омега-3', 0, 100, 0),
            new Food(11, 'овощи Königs Gemüse', 2, 2.6, 5.3),
            new Food(12, 'печень куриная', 19.1, 6.3, 0.6),
            new Food(13, 'овощи Mediterrane Art', 1.4, 2.3, 3.5),
            new Food(14, 'овощи Wok Mix', 1.6, 2.5, 5.6),
            new Food(15, 'хрустики рисовые', 8.9, 3.8, 77),
            new Food(16, 'овощи Brokkoli & Blumenkohl', 2.6, 1, 3.3),
            new Food(17, 'курогрудь', 23.6, 2.5, 0.4),
            new Food(18, 'овощи Iglo Kürbis Qinoa', 3.2, 2.0, 9.3),
            new Food(18, 'рыба филе Edeka Bio', 20, 1, 3),
            new Food(19, 'индюшиные сердечки', 16, 5.1, 0.4),
        ];

        foodBasket.sort(function (a, b) {
            var textA = a.name.toUpperCase();
            var textB = b.name.toUpperCase();
            return (textA < textB) ? -1 : (textA > textB) ? 1 : 0;
        });

        var selectedFood = [];
        var foodTableRowsCount = new Map();
        foodTableRowsCount.set('zavtrak', 1);
        foodTableRowsCount.set('perekus_1', 1);
        foodTableRowsCount.set('perekus_2', 1);
        foodTableRowsCount.set('obed', 1);
        foodTableRowsCount.set('uzhin', 1);

        var mealTimeBelki = new Map();
        var mealTimeGiri = new Map();
        var mealTimeUglevodi = new Map();

        function addProduct(tableId) {
            var table = document.getElementById(tableId);
            var rowCount = foodTableRowsCount.get(tableId);
            var row = table.insertRow(rowCount);
            row.id = tableId + '-row-' + rowCount;
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            cell1.innerHTML = '<input type="button" value="X" onclick="removeProduct(' + rowCount + ', \'' + tableId + '\');">';
            cell2.innerHTML = '<select class="selectedFood" id="' + tableId + '_sel-' + rowCount + '">\n' +
                '                    <option value="">---</option>\n' +
                '                </select>';
            cell3.innerHTML = '<input class="selectedMass" id="' + tableId + '_mass-' + rowCount + '" type="text" size="10" onkeyup="calculate();">';
            var ele = document.getElementById(tableId + '_sel-' + rowCount);
            for (var i = 0; i < foodBasket.length; i++) {
                ele.innerHTML = ele.innerHTML +
                    '<option value="' + foodBasket[i].id + '">' + foodBasket[i].name + '</option>';
            }
            foodTableRowsCount.set(tableId, rowCount + 1)
        }

        function calculate() {
            let selects = document.getElementsByClassName("selectedFood");
            let masses = document.getElementsByClassName("selectedMass");
            var belki = 0;
            var giri = 0;
            var uglevodi = 0;
            for (let i = 0; i < selects.length; i++) {
                // zavtrak_sel-1
                // zavtrak_mass-1
                let select = selects[i];
                let mealType = select.id.split("_sel")[0];
                let inputNumber = select.id.split("-")[1];
                let mass = document.getElementById(mealType + "_mass-" + inputNumber).value;
                let food = findObjectByKey(foodBasket, 'id', parseInt(select.value));
                belki += mass * food.belki / 100;
                giri += mass * food.giri / 100;
                uglevodi += mass * food.uglevodi / 100;
            }
            document.getElementById("planBelki").innerHTML = belki;
            document.getElementById("planGiri").innerHTML = giri;
            document.getElementById("planUglevodi").innerHTML = uglevodi;
            var total = belki * 4 + giri * 9 + uglevodi * 4;
            document.getElementById("total").innerHTML = total;
        }

        function findObjectByKey(array, key, value) {
            for (var i = 0; i < array.length; i++) {
                if (array[i][key] === value) {
                    return array[i];
                }
            }
            return null;
        }

        function getWeekdayBelki() {
            return weight * 2;
        }

        function getWeekdayGiri() {
            return weight / 2;
        }

        function getWeekdayUglevodi() {
            return weight * 2;
        }

        function getSaturdayBelki() {
            return weight / 2;
        }

        function getSaturdayGiri() {
            return weight;
        }

        function getSaturdayUglevodi() {
            return weight * 8;
        }

        function getSundayBelki() {
            return weight * 2;
        }

        function getSundayGiri() {
            return weight / 2;
        }

        function getSundayUglevodi() {
            return weight * 4;
        }

        function removeProduct(number, tableId) {
            var row = document.getElementById(tableId + '-row-' + number);
            row.parentElement.removeChild(row);
            let rowIndex = foodTableRowsCount.get(tableId);
            foodTableRowsCount.set(tableId, rowIndex - 1);
            calculate();
        }

        function init() {
            document.getElementById('weight').innerHTML = weight;
            document.getElementById('weekdayBelki').innerHTML = getWeekdayBelki();
            document.getElementById('weekdayGiri').innerHTML = getWeekdayGiri();
            document.getElementById('weekdayUglevodi').innerHTML = getWeekdayUglevodi();
            document.getElementById('saturdayBelki').innerHTML = getSaturdayBelki();
            document.getElementById('saturdayGiri').innerHTML = getSaturdayGiri();
            document.getElementById('saturdayUglevodi').innerHTML = getSaturdayUglevodi();
            document.getElementById('sundayBelki').innerHTML = getSundayBelki();
            document.getElementById('sundayGiri').innerHTML = getSundayGiri();
            document.getElementById('sundayUglevodi').innerHTML = getSundayUglevodi();
            document.getElementById('plan').innerHTML = "План [" + formatDay(tomorrowDay) + "]"
        }

        function formatDay(dayNumber) {
            switch (dayNumber) {
                case 1:
                    return "Понедельник";
                case 2:
                    return "Вторник";
                case 3:
                    return "Среда";
                case 4:
                    return "Четвера";
                case 5:
                    return "Пятница";
                case 6:
                    return "Суббота";
                case 7:
                    return "Воскресенье";
            }
        }
    </script>
</head>
<body onload="init();">
Вес: <span id="weight"></span><br><br>
<table>
    <tr>
        <td>
            <table id="weekdayPlan">
                <tr>
                    <td>ПН - ПТ</td>
                </tr>
                <tr>
                    <td>
                        Белки
                    </td>
                    <td>&nbsp;&nbsp;&nbsp;</td>
                    <td>
                        <span id="weekdayBelki"></span>
                    </td>
                </tr>
                <tr>
                    <td>
                        Жиры
                    </td>
                    <td>&nbsp;&nbsp;&nbsp;</td>
                    <td>
                        <span id="weekdayGiri"></span>
                    </td>
                </tr>
                <tr>
                    <td>
                        Углеводы
                    </td>
                    <td>&nbsp;&nbsp;&nbsp;</td>
                    <td>
                        <span id="weekdayUglevodi"></span>
                    </td>
                </tr>
            </table>
        </td>
        <td>&nbsp;&nbsp;&nbsp;</td>
        <td>
            <table id="saturdayPlan">
                <tr>
                    <td>СБ</td>
                </tr>
                <tr>
                    <td>
                        Белки
                    </td>
                    <td>&nbsp;&nbsp;&nbsp;</td>
                    <td>
                        <span id="saturdayBelki"></span>
                    </td>
                </tr>
                <tr>
                    <td>
                        Жиры
                    </td>
                    <td>&nbsp;&nbsp;&nbsp;</td>
                    <td>
                        <span id="saturdayGiri"></span>
                    </td>
                </tr>
                <tr>
                    <td>
                        Углеводы
                    </td>
                    <td>&nbsp;&nbsp;&nbsp;</td>
                    <td>
                        <span id="saturdayUglevodi"></span>
                    </td>
                </tr>
            </table>
        </td>
        <td>&nbsp;&nbsp;&nbsp;</td>
        <td>
            <table id="sundayPlan">
                <tr>
                    <td>ВС</td>
                </tr>
                <tr>
                    <td>
                        Белки
                    </td>
                    <td>&nbsp;&nbsp;&nbsp;</td>
                    <td>
                        <span id="sundayBelki"></span>
                    </td>
                </tr>
                <tr>
                    <td>
                        Жиры
                    </td>
                    <td>&nbsp;&nbsp;&nbsp;</td>
                    <td>
                        <span id="sundayGiri"></span>
                    </td>
                </tr>
                <tr>
                    <td>
                        Углеводы
                    </td>
                    <td>&nbsp;&nbsp;&nbsp;</td>
                    <td>
                        <span id="sundayUglevodi"></span>
                    </td>
                </tr>
            </table>
        </td>
        <td>&nbsp;&nbsp;&nbsp;</td>
        <td>
            <table id="sundayPlan">
                <tr>
                    <td><span id="plan"></span></td>
                </tr>
                <tr>
                    <td>
                        Белки
                    </td>
                    <td>&nbsp;&nbsp;&nbsp;</td>
                    <td>
                        <span id="planBelki"></span>
                    </td>
                </tr>
                <tr>
                    <td>
                        Жиры
                    </td>
                    <td>&nbsp;&nbsp;&nbsp;</td>
                    <td>
                        <span id="planGiri"></span>
                    </td>
                </tr>
                <tr>
                    <td>
                        Углеводы
                    </td>
                    <td>&nbsp;&nbsp;&nbsp;</td>
                    <td>
                        <span id="planUglevodi"></span>
                    </td>
                </tr>
            </table>
        </td>
        <td>&nbsp;&nbsp;&nbsp;</td>
        <td>
            <table>
                <tr>
                    <td><span>Калории</span></td>
                    <td><span id="total"></span></td>
                </tr>
            </table>
        </td>
    </tr>
</table>
<br>
<table id="zavtrak">
    <tr>
        <td><b>Завтрак</b></td>
    </tr>
</table>
<p>
    <input type="button"
           onclick="addProduct('zavtrak')"
           value="Добавить продукт"/>
</p>
<br>
<table id="perekus_1">
    <tr>
        <td><b>Перекус 1</b></td>
    </tr>
</table>
<p>
    <input type="button"
           onclick="addProduct('perekus_1')"
           value="Добавить продукт"/>
</p>
<br>
<table id="obed">
    <tr>
        <td><b>Обед</b></td>
    </tr>
</table>
<p>
    <input type="button"
           onclick="addProduct('obed')"
           value="Добавить продукт"/>
</p>
<br>
<table id="perekus_2">
    <tr>
        <td><b>Перекус 2</b></td>
    </tr>
</table>
<p>
    <input type="button"
           onclick="addProduct('perekus_2')"
           value="Добавить продукт"/>
</p>
<br>
<table id="uzhin">
    <tr>
        <td><b>Ужин</b></td>
    </tr>
</table>
<p>
    <input type="button"
           onclick="addProduct('uzhin')"
           value="Добавить продукт"/>
</p>
</body>
</html>